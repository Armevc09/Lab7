import cv2
import os

# Crear la carpeta "Capturas" si no existe
if not os.path.exists('Capturas'):
    os.makedirs('Capturas')

# Inicializar la captura de la cámara web
cap = cv2.VideoCapture(0)

# Verificar si la cámara se abrió correctamente
if not cap.isOpened():
    print("Error: No se pudo abrir la cámara.")
    exit()

# Contador de imágenes
counter = 1

while True:
    # Leer el fotograma
    ret, frame = cap.read()

    if not ret:
        print("Error: No se pudo obtener el fotograma.")
        break

    # Mostrar el fotograma
    cv2.imshow('Cámara Web', frame)

    # Esperar una tecla
    key = cv2.waitKey(1) & 0xFF

    # Si se presiona la tecla 'c', guardar la imagen
    if key == ord('c'):
        # Guardar la imagen en la carpeta "Capturas" con el nombre "imagenX.jpg"
        filename = f"Capturas/imagen{counter}.jpg"
        cv2.imwrite(filename, frame)
        print(f"Imagen {filename} guardada.")
        counter += 1

    # Si se presiona la tecla 'q', salir
    if key == ord('q'):
        break

# Liberar la cámara y cerrar las ventanas
cap.release()
cv2.destroyAllWindows()

# Si se ha guardado al menos una imagen, aplicar el filtro y dividir en cuadrantes
if counter > 1:
    # Cargar la última imagen guardada
    last_image = cv2.imread(f"Capturas/imagen{counter - 1}.jpg")

    # Convertir la imagen a escala de grises
    gray_image = cv2.cvtColor(last_image, cv2.COLOR_BGR2GRAY)

    # Dividir la imagen en 4 cuadrantes
    height, width = gray_image.shape
    top_left = gray_image[0:height//2, 0:width//2]
    top_right = gray_image[0:height//2, width//2:]
    bottom_left = gray_image[height//2:, 0:width//2]
    bottom_right = gray_image[height//2:, width//2:]

    # Mostrar los cuadrantes
    cv2.imshow('Top Left', top_left)
    cv2.imshow('Top Right', top_right)
    cv2.imshow('Bottom Left', bottom_left)
    cv2.imshow('Bottom Right', bottom_right)

    # Esperar a que se presione una tecla para cerrar
    cv2.waitKey(0)
    cv2.destroyAllWindows()
